(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/menu/menu"],{"0db8":function(t,e,r){"use strict";r.r(e);var o=r("bb92"),n=r.n(o);for(var i in o)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return o[t]}))}(i);e["default"]=n.a},1470:function(t,e,r){},"33e7":function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return o}));var o={modal:function(){return r.e("components/modal/modal").then(r.bind(null,"044a"))},popupLayer:function(){return r.e("components/popup-layer/popup-layer").then(r.bind(null,"3f2f"))}},n=function(){var t=this,e=t.$createElement,r=(t._self._c,t.loading?null:t.goods.length),o=!t.loading&&r?t.__map(t.goods,(function(e,r){var o=t.__get_orig(e),n=t.menuCartNum(e.id),i=t.menuCartNum(e.id);return{$orig:o,m0:n,m1:i}})):null,n=!t.loading&&r?t.__map(t.goods,(function(e,r){var o=t.__get_orig(e),n=t.__map(e.goods_list,(function(e,r){var o=t.__get_orig(e),n=e.is_sell&&e.use_property?t.goodCartNum(e.id):null,i=e.is_sell&&e.use_property?t.goodCartNum(e.id):null,a=e.is_sell&&!e.use_property?t.goodCartNum(e.id):null,u=e.is_sell&&!e.use_property?t.goodCartNum(e.id):null,s=e.is_sell&&!e.use_property?t.goodCartNum(e.id):null;return{$orig:o,m2:n,m3:i,m4:a,m5:u,m6:s}}));return{$orig:o,l1:n}})):null,i=!t.loading&&r?t.cart.length:null,a=t.loading?null:t.getGoodSelectedProps(t.good),u=!t.loading&&a?t.getGoodSelectedProps(t.good):null,s=!t.loading&&"takeout"==t.orderType&&t.store.packing_fee?parseFloat(t.store.packing_fee):null;t.$mp.data=Object.assign({},{$root:{g0:r,l0:o,l2:n,g1:i,m7:a,m8:u,m9:s}})},i=[]},"47dd":function(t,e,r){"use strict";(function(t,e){var o=r("47a9");r("e392"),r("861b");o(r("3240"));var n=o(r("89ed"));t.__webpack_require_UNI_MP_PLUGIN__=r,e(n.default)}).call(this,r("3223")["default"],r("df3c")["createPage"])},"89ed":function(t,e,r){"use strict";r.r(e);var o=r("33e7"),n=r("0db8");for(var i in n)["default"].indexOf(i)<0&&function(t){r.d(e,t,(function(){return n[t]}))}(i);r("afeb");var a=r("828b"),u=Object(a["a"])(n["default"],o["b"],o["c"],!1,null,"6a6a6be2",null,!1,o["a"],void 0);e["default"]=u.exports},afeb:function(t,e,r){"use strict";var o=r("1470"),n=r.n(o);n.a},bb92:function(t,e,r){"use strict";(function(t,o){var n=r("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(r("7eb4")),a=n(r("7ca3")),u=n(r("ee10")),s=r("8f59");function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){(0,a.default)(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var d={components:{modal:function(){r.e("components/modal/modal").then(function(){return resolve(r("044a"))}.bind(null,r)).catch(r.oe)},popupLayer:function(){r.e("components/popup-layer/popup-layer").then(function(){return resolve(r("3f2f"))}.bind(null,r)).catch(r.oe)}},data:function(){return{goods:[],ads:[{image:"/static/images/order/top.png"},{image:"/static/images/order/top2.png"}],loading:!0,currentCateId:"",cateScrollTop:0,menuScrollIntoView:"",cart:[],goodDetailModalVisible:!1,good:{},category:{},cartPopupVisible:!1,sizeCalcState:!1,flag:!1}},onLoad:function(){var t=this;return(0,u.default)(i.default.mark((function e(){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:case"end":return e.stop()}}),e)})))()},computed:l(l(l({},(0,s.mapState)(["orderType","address","store"])),(0,s.mapGetters)(["isLogin"])),{},{goodCartNum:function(){var t=this;return function(e){return t.cart.reduce((function(t,r){return r.id===e?t+r.number:t}),0)}},menuCartNum:function(){var t=this;return function(e){return t.cart.reduce((function(t,r){return r.cate_id===e?t+r.number:t}),0)}},getCartGoodsNumber:function(){return this.cart.reduce((function(t,e){return t+e.number}),0)},getCartGoodsPrice:function(){return this.cart.reduce((function(t,e){return t+e.number*e.price}),0)},disabledPay:function(){return"takeout"==this.orderType&&this.getCartGoodsPrice<this.store.min_price},spread:function(){if("takeout"==this.orderType)return parseFloat((this.store.min_price-this.getCartGoodsPrice).toFixed(2))}}),methods:l(l(l({},(0,s.mapMutations)(["SET_ORDER_TYPE"])),(0,s.mapActions)(["getStore"])),{},{init:function(){var e=this;return(0,u.default)(i.default.mark((function r(){return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return e.loading=!0,r.next=3,e.fetchGoodsData();case 3:e.loading=!1,e.cart=t.getStorageSync("cart")||[];case 5:case"end":return r.stop()}}),r)})))()},fetchGoodsData:function(){var t=this;return(0,u.default)(i.default.mark((function e(){var r;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,o.callFunction({name:"getGoodsData"});case 3:r=e.sent,200===r.result.code?t.goods=r.result.data:console.error("获取商品数据失败:",r.result.message),e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),console.error("调用云函数失败:",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))()},takout:function(){"takeout"!=this.orderType&&(this.isLogin?t.navigateTo({url:"/pages/address/address?is_choose=true"}):t.navigateTo({url:"/pages/login/login"}))},handleMenuTap:function(t){var e=this;this.sizeCalcState||this.calcSize(),this.currentCateId=t,this.$nextTick((function(){return e.cateScrollTop=e.goods.find((function(e){return e.id==t})).top}))},handleGoodsScroll:function(t){var e=t.detail;this.sizeCalcState||this.calcSize();var r=e.scrollTop,o=this.goods.filter((function(t){return t.top<=r})).reverse();o.length>0&&(this.currentCateId=o[0].id)},calcSize:function(){var e=10,r=t.createSelectorQuery().select("#ads");r.fields({size:!0},(function(t){e+=Math.floor(t.height)})).exec(),this.goods.forEach((function(r){var o=t.createSelectorQuery().select("#cate-".concat(r.id));o.fields({size:!0},(function(t){r.top=e,e+=t.height,r.bottom=e})).exec()})),this.sizeCalcState=!0},handleAddToCart:function(t,e,r){this.flag||0!=e.price||(this.flag=!0);var o=this.cart.findIndex((function(t){return e.use_property?t.id===e.id&&t.props_text===e.props_text:t.id===e.id}));console.log(e),o>-1?this.cart[o].number+=r:this.cart.push({id:e.id,cate_id:t.id,name:e.name,price:e.price,number:r,image:e.images,use_property:e.use_property,props_text:e.props_text,props:e.props})},handleReduceFromCart:function(t,e){var r=this.cart.findIndex((function(t){return t.id===e.id}));this.cart[r].number-=1,this.cart[r].number<=0&&(this.cart.splice(r,1),this.flag&&0==e.price&&(this.flag=!1))},showGoodDetailModal:function(t,e){this.good=JSON.parse(JSON.stringify(l(l({},e),{},{number:1}))),this.category=JSON.parse(JSON.stringify(t)),this.goodDetailModalVisible=!0},closeGoodDetailModal:function(){this.goodDetailModalVisible=!1,this.category={},this.good={}},changePropertyDefault:function(t,e){var r=this;this.good.property[t].values.forEach((function(t){return r.$set(t,"is_default",0)})),this.good.property[t].values[e].is_default=1,this.good.number=1},getGoodSelectedProps:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(t.use_property){var r=[];return t.property.forEach((function(t){var o=t.values;o.forEach((function(t){t.is_default&&r.push("text"===e?t.value:t.id)}))})),"text"===e?r.join("，"):r}return""},handlePropertyAdd:function(){this.good.number+=1},handlePropertyReduce:function(){1!==this.good.number&&(this.good.number-=1)},handleAddToCartInModal:function(){var t=Object.assign({},this.good,{props_text:this.getGoodSelectedProps(this.good),props:this.getGoodSelectedProps(this.good,"id")});this.handleAddToCart(this.category,t,this.good.number),this.closeGoodDetailModal()},openCartPopup:function(){this.cartPopupVisible=!this.cartPopupVisible},handleCartClear:function(){var e=this;t.showModal({title:"提示",content:"确定清空购物车么",success:function(t){var r=t.confirm;r&&(e.cartPopupVisible=!1,e.cart=[])}})},handleCartItemAdd:function(t){this.cart[t].number+=1},handleCartItemReduce:function(t){1===this.cart[t].number?this.cart.splice(t,1):this.cart[t].number-=1,this.cart.length||(this.cartPopupVisible=!1)},toPay:function(){this.isLogin?this.flag?(t.showLoading({title:"加载中"}),t.setStorageSync("cart",JSON.parse(JSON.stringify(this.cart))),t.navigateTo({url:"/pages/pay/pay"}),t.hideLoading()):t.showToast({title:"口味是必选的哦~请前往选择口味~",icon:"none"}):t.navigateTo({url:"/pages/login/login"})}})};e.default=d}).call(this,r("df3c")["default"],r("861b")["default"])}},[["47dd","common/runtime","common/vendor"]]]);