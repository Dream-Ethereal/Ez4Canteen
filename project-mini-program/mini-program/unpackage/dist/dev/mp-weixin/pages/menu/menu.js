(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/menu/menu"],{60:function(e,t,r){"use strict";(function(e,t){var n=r(4);r(26),r(27);n(r(25));var o=n(r(61));e.__webpack_require_UNI_MP_PLUGIN__=r,t(o.default)}).call(this,r(1)["default"],r(2)["createPage"])},61:function(e,t,r){"use strict";r.r(t);var n=r(62),o=r(64);for(var i in o)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(i);r(66);var a,s=r(44),u=Object(s["default"])(o["default"],n["render"],n["staticRenderFns"],!1,null,"368aef34",null,!1,n["components"],a);u.options.__file="pages/menu/menu.vue",t["default"]=u.exports},62:function(e,t,r){"use strict";r.r(t);var n=r(63);r.d(t,"render",(function(){return n["render"]})),r.d(t,"staticRenderFns",(function(){return n["staticRenderFns"]})),r.d(t,"recyclableRender",(function(){return n["recyclableRender"]})),r.d(t,"components",(function(){return n["components"]}))},63:function(e,t,r){"use strict";var n;r.r(t),r.d(t,"render",(function(){return o})),r.d(t,"staticRenderFns",(function(){return a})),r.d(t,"recyclableRender",(function(){return i})),r.d(t,"components",(function(){return n}));try{n={modal:function(){return r.e("components/modal/modal").then(r.bind(null,155))},popupLayer:function(){return r.e("components/popup-layer/popup-layer").then(r.bind(null,162))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,t=e.$createElement,r=(e._self._c,e.loading?null:e.goods.length),n=!e.loading&&r?e.__map(e.goods,(function(t,r){var n=e.__get_orig(t),o=e.menuCartNum(t.id),i=e.menuCartNum(t.id);return{$orig:n,m0:o,m1:i}})):null,o=!e.loading&&r?e.__map(e.goods,(function(t,r){var n=e.__get_orig(t),o=e.__map(t.goods_list,(function(t,r){var n=e.__get_orig(t),o=t.is_sell&&t.use_property?e.goodCartNum(t.id):null,i=t.is_sell&&t.use_property?e.goodCartNum(t.id):null,a=t.is_sell&&!t.use_property?e.goodCartNum(t.id):null,s=t.is_sell&&!t.use_property?e.goodCartNum(t.id):null,u=t.is_sell&&!t.use_property?e.goodCartNum(t.id):null;return{$orig:n,m2:o,m3:i,m4:a,m5:s,m6:u}}));return{$orig:n,l1:o}})):null,i=!e.loading&&r?e.cart.length:null,a=e.loading?null:e.getGoodSelectedProps(e.good),s=!e.loading&&a?e.getGoodSelectedProps(e.good):null,u=!e.loading&&"takeout"==e.orderType&&e.store.packing_fee?parseFloat(e.store.packing_fee):null;e.$mp.data=Object.assign({},{$root:{g0:r,l0:n,l2:o,g1:i,m7:a,m8:s,m9:u}})},i=!1,a=[];o._withStripped=!0},64:function(e,t,r){"use strict";r.r(t);var n=r(65),o=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},65:function(e,t,r){"use strict";(function(e,n){var o=r(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(r(28)),a=o(r(11)),s=o(r(31)),u=r(49);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d=function(){r.e("components/modal/modal").then(function(){return resolve(r(155))}.bind(null,r)).catch(r.oe)},p=function(){r.e("components/popup-layer/popup-layer").then(function(){return resolve(r(162))}.bind(null,r)).catch(r.oe)},f={components:{modal:d,popupLayer:p},data:function(){return{goods:[],ads:[{image:"/static/images/order/top.png"},{image:"/static/images/order/top2.png"}],loading:!0,currentCateId:"",cateScrollTop:0,menuScrollIntoView:"",cart:[],goodDetailModalVisible:!1,good:{},category:{},cartPopupVisible:!1,sizeCalcState:!1,flag:!1}},onLoad:function(){var e=this;return(0,s.default)(i.default.mark((function t(){return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.init();case 2:case"end":return t.stop()}}),t)})))()},computed:l(l(l({},(0,u.mapState)(["orderType","address","store"])),(0,u.mapGetters)(["isLogin"])),{},{goodCartNum:function(){var e=this;return function(t){return e.cart.reduce((function(e,r){return r.id===t?e+r.number:e}),0)}},menuCartNum:function(){var e=this;return function(t){return e.cart.reduce((function(e,r){return r.cate_id===t?e+r.number:e}),0)}},getCartGoodsNumber:function(){return this.cart.reduce((function(e,t){return e+t.number}),0)},getCartGoodsPrice:function(){return this.cart.reduce((function(e,t){return e+t.number*t.price}),0)},disabledPay:function(){return"takeout"==this.orderType&&this.getCartGoodsPrice<this.store.min_price},spread:function(){if("takeout"==this.orderType)return parseFloat((this.store.min_price-this.getCartGoodsPrice).toFixed(2))}}),methods:l(l(l({},(0,u.mapMutations)(["SET_ORDER_TYPE"])),(0,u.mapActions)(["getStore"])),{},{init:function(){var t=this;return(0,s.default)(i.default.mark((function r(){return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.loading=!0,r.next=3,t.fetchGoodsData();case 3:t.loading=!1,t.cart=e.getStorageSync("cart")||[];case 5:case"end":return r.stop()}}),r)})))()},fetchGoodsData:function(){var e=this;return(0,s.default)(i.default.mark((function t(){var r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.callFunction({name:"getGoodsData"});case 3:r=t.sent,200===r.result.code?e.goods=r.result.data:console.error("获取商品数据失败:",r.result.message),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),console.error("调用云函数失败:",t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},takout:function(){"takeout"!=this.orderType&&(this.isLogin?e.navigateTo({url:"/pages/address/address?is_choose=true"}):e.navigateTo({url:"/pages/login/login"}))},handleMenuTap:function(e){var t=this;this.sizeCalcState||this.calcSize(),this.currentCateId=e,this.$nextTick((function(){return t.cateScrollTop=t.goods.find((function(t){return t.id==e})).top}))},handleGoodsScroll:function(e){var t=e.detail;this.sizeCalcState||this.calcSize();var r=t.scrollTop,n=this.goods.filter((function(e){return e.top<=r})).reverse();n.length>0&&(this.currentCateId=n[0].id)},calcSize:function(){var t=10,r=e.createSelectorQuery().select("#ads");r.fields({size:!0},(function(e){t+=Math.floor(e.height)})).exec(),this.goods.forEach((function(r){var n=e.createSelectorQuery().select("#cate-".concat(r.id));n.fields({size:!0},(function(e){r.top=t,t+=e.height,r.bottom=t})).exec()})),this.sizeCalcState=!0},handleAddToCart:function(e,t,r){this.flag||0!=t.price||(this.flag=!0);var n=this.cart.findIndex((function(e){return t.use_property?e.id===t.id&&e.props_text===t.props_text:e.id===t.id}));console.log(t),n>-1?this.cart[n].number+=r:this.cart.push({id:t.id,cate_id:e.id,name:t.name,price:t.price,number:r,image:t.images,use_property:t.use_property,props_text:t.props_text,props:t.props})},handleReduceFromCart:function(e,t){var r=this.cart.findIndex((function(e){return e.id===t.id}));this.cart[r].number-=1,this.cart[r].number<=0&&(this.cart.splice(r,1),this.flag&&0==t.price&&(this.flag=!1))},showGoodDetailModal:function(e,t){this.good=JSON.parse(JSON.stringify(l(l({},t),{},{number:1}))),this.category=JSON.parse(JSON.stringify(e)),this.goodDetailModalVisible=!0},closeGoodDetailModal:function(){this.goodDetailModalVisible=!1,this.category={},this.good={}},changePropertyDefault:function(e,t){var r=this;this.good.property[e].values.forEach((function(e){return r.$set(e,"is_default",0)})),this.good.property[e].values[t].is_default=1,this.good.number=1},getGoodSelectedProps:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";if(e.use_property){var r=[];return e.property.forEach((function(e){var n=e.values;n.forEach((function(e){e.is_default&&r.push("text"===t?e.value:e.id)}))})),"text"===t?r.join("，"):r}return""},handlePropertyAdd:function(){this.good.number+=1},handlePropertyReduce:function(){1!==this.good.number&&(this.good.number-=1)},handleAddToCartInModal:function(){var e=Object.assign({},this.good,{props_text:this.getGoodSelectedProps(this.good),props:this.getGoodSelectedProps(this.good,"id")});this.handleAddToCart(this.category,e,this.good.number),this.closeGoodDetailModal()},openCartPopup:function(){this.cartPopupVisible=!this.cartPopupVisible},handleCartClear:function(){var t=this;e.showModal({title:"提示",content:"确定清空购物车么",success:function(e){var r=e.confirm;r&&(t.cartPopupVisible=!1,t.cart=[])}})},handleCartItemAdd:function(e){this.cart[e].number+=1},handleCartItemReduce:function(e){1===this.cart[e].number?this.cart.splice(e,1):this.cart[e].number-=1,this.cart.length||(this.cartPopupVisible=!1)},toPay:function(){this.isLogin?this.flag?(e.showLoading({title:"加载中"}),e.setStorageSync("cart",JSON.parse(JSON.stringify(this.cart))),e.navigateTo({url:"/pages/pay/pay"}),e.hideLoading()):e.showToast({title:"口味是必选的哦~请前往选择口味~",icon:"none"}):e.navigateTo({url:"/pages/login/login"})}})};t.default=f}).call(this,r(2)["default"],r(27)["default"])},66:function(e,t,r){"use strict";r.r(t);var n=r(67),o=r.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(i);t["default"]=o.a},67:function(e,t,r){}},[[60,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/menu/menu.js.map